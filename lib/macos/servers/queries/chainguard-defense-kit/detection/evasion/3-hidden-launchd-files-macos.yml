- name: CDK - Hidden Launchd Files Macos
  description: Reveal launchd services which are located in a hidden directory. This
    query was written because osquery can't see these entries currently. See https://github.com/osquery/osquery/issues/7703
  query: "SELECT\n  file.path,\n  file.type,\n  file.filename,\n  file.size,\n  file.mtime,\n\
    \  file.uid,\n  file.ctime,\n  file.gid,\n  hash.sha256,\n  signature.identifier,\n\
    \  signature.authority\nFROM\n  file\n  LEFT JOIN signature ON file.path = signature.path\n\
    \  LEFT JOIN hash ON file.path = hash.path\nWHERE\n  (\n    file.path LIKE '/Library/LaunchAgents/.%'\n\
    \    OR file.path LIKE '/Users/%/Library/LaunchAgents/.%'\n    OR file.path LIKE\
    \ '/Users/%/Library/LaunchDaemons/.%'\n  )\n  AND file.filename NOT IN ('.', '..',\
    \ '.DS_Store')\n  AND NOT (\n    file.filename = '.DS_Store'\n    AND hash.sha256\
    \ = 'd65165279105ca6773180500688df4bdc69a2c7b771752f0a46ef120b7fd8ec3'\n  )\n\
    \  -- Kandji temp file\n  AND NOT (\n    file.path LIKE '/Library/LaunchAgents/.dat.nosync%'\n\
    \    AND size = 242\n  )\n"
  platform: darwin
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
