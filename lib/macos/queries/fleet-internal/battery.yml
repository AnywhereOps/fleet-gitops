---
apiVersion: v1
kind: built-in
spec:
  name: Battery
  platform: windows, darwin
  description: Determines battery health based on the cycle count, designed capacity, and max capacity of the battery.
  query: |
    SELECT 
      serial_number, cycle_count, designed_capacity, max_capacity 
    FROM battery
  powershell: >-
    $battery = Get-CimInstance Win32_Battery

    if (-not $battery) {
        Write-Output "No battery information available."
        exit
    }

    $battery | Select-Object `
        @{Name='serial_number';Expression={$_.SerialNumber}}, `
        @{Name='cycle_count';Expression={$_.CycleCount}}, `
        @{Name='designed_capacity';Expression={$_.DesignCapacity}}, `
        @{Name='max_capacity';Expression={$_.FullChargeCapacity}} | Format-Table -AutoSize
  bash: echo "serial_number,cycle_count,designed_capacity,max_capacity" && ioreg -rn AppleSmartBattery -w0 | awk -F' = ' '/BatterySerialNumber/ {gsub(/"/,"",$2); sn=$2} /CycleCount/ {cc=$2} /DesignCapacity/ {dc=$2} /MaxCapacity/ {mc=$2} END {print sn","cc","dc","mc}'
  purpose: Informational
  tags: built-in
  discovery: battery