- name: CDK - Fake Apple Launchd
  description: Find launchd entries which purport to be by Apple, but point to binaries
    that are not signed by Apple.
  query: "SELECT\n  *\nFROM\n  launchd\n  LEFT JOIN file ON launchd.path = file.path\n\
    \  LEFT JOIN signature ON launchd.program_arguments = signature.path\nWHERE\n\
    \  launchd.name LIKE 'com.apple.%'\n  -- Optimization, assumes SIP\n  AND file.directory\
    \ NOT IN (\n    '/Library/Apple/System/Library/LaunchAgents',\n    '/Library/Apple/System/Library/LaunchDaemons',\n\
    \    '/System/Library/LaunchAgents',\n    '/System/Library/LaunchDaemons'\n  )\n\
    \  AND launchd.run_at_load = 1\n  AND signature.authority != 'Software Signing'\n"
  platform: darwin
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
