---
apiVersion: v1
kind: query
spec:
  name: unauthenticated_sparkle_feeds
  platform: darwin
  description: Retrieves all application bundles using unauthenticated Sparkle update feeds. See (https://vulnsec.com/2016/osx-apps-vulnerabilities/) for details.
  query: select feeds.*, p2.value as sparkle_version from (select a.name as app_name, a.path as app_path, a.bundle_identifier as bundle_id, p.value as feed_url from (select name, path, bundle_identifier
    from apps) a, plist p where p.path = a.path || '/Contents/Info.plist' and p.key = 'SUFeedURL' and feed_url like 'http://%') feeds left outer join plist p2 on p2.path = app_path || '/Contents/Frameworks/Sparkle.framework/Resources/Info.plist'
    where (p2.key = 'CFBundleShortVersionString' OR coalesce(p2.key, '') = '');
  interval: '86400'
  value: Tracking vulnerable applications updates may allow blocking of DNS or removal by BundleID.
  version: 1.4.5
