- name: CDK - Unexpected Var Run Macos
  description: Find unexpected regular files in /var/run
  query: "SELECT\n  file.filename,\n  uid,\n  gid,\n  mode,\n  file.ctime,\n  file.atime,\n\
    \  file.mtime,\n  file.size,\n  hash.sha256,\n  magic.data\nFROM\n  file\n  LEFT\
    \ JOIN hash on file.path = hash.path\n  LEFT JOIN magic ON file.path = magic.path\n\
    WHERE\n  file.directory = \"/var/run\"\n  AND file.type = \"regular\"\n  AND file.filename\
    \ NOT IN (\n    '.autoBackup',\n    '.DidRunFLO',\n    '.fctcompsupdate',\n  \
    \  'appfwd.pid',\n    'auditd.pid',\n    'automount.initialized',\n    'bootpd.pid',\n\
    \    'com.apple.DumpPanic.finishedPMUFaultHandling',\n    'com.apple.DumpPanic.finishedThisBoot',\n\
    \    'com.apple.logind.didRunThisBoot',\n    'com.apple.loginwindow.didRunThisBoot',\n\
    \    'com.apple.mdmclient.daemon.didRunThisBoot',\n    'com.apple.mobileassetd-MobileAssetBrain',\n\
    \    'com.apple.parentalcontrols.webfilterctl.mutex',\n    'com.apple.softwareupdate.availableupdatesupdated',\n\
    \    'com.apple.WindowServer.didRunThisBoot',\n    'diskarbitrationd.pid',\n \
    \   'fctc.s',\n    'FirstBootAfterUpdate',\n    'FirstBootCleanupHandled',\n \
    \   'hdiejectd.pid',\n    'installd.commit.pid',\n    'kdc.pid',\n    'MobileAssetCritialDomainsUpdated.plist',\n\
    \    'MobileAssetStartupActivation.doneThisBoot',\n    'prl_desktop_services_foreground.lock',\n\
    \    'prl_desktop_services.lock',\n    'prl_disp_service.pid',\n    'prl_disp_service.urgent',\n\
    \    'prl_naptd.pid',\n    'prl_watchdog-ebdba5702a20.pid',\n    'resolv.conf',\n\
    \    'rtadvd.pid',\n    'signpost_reporter_running',\n    'socketfilterfw.launchd',\n\
    \    'syslog.pid',\n    'systemkeychaincheck.done',\n    'utmpx',\n    'VMware\
    \ Fusion Services.lock',\n    'wifi'\n  )\n  AND NOT file.filename LIKE '%.pid'\n\
    GROUP BY\n  file.path;\n"
  platform: darwin
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
