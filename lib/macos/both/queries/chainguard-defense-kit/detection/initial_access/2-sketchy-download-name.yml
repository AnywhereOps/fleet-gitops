- name: CDK - Sketchy Download Name
  description: Look for sketchy download files based on keywords
  query: "SELECT\n  file.filename,\n  REGEX_MATCH (file.filename, '.*\\.(.*?)$', 1)\
    \ AS extension,\n  magic.data,\n  hash.sha256,\n  ea.value AS download_url,\n\
    \  signature.authority AS s_auth,\n  signature.identifier AS s_id\nFROM\n  file\n\
    \  LEFT JOIN magic ON file.path = magic.path\n  LEFT JOIN hash ON file.path =\
    \ hash.path\n  LEFT JOIN extended_attributes ea ON file.path = ea.path\n  AND\
    \ ea.key = \"where_from\"\n  LEFT JOIN signature ON file.path = signature.path\n\
    WHERE\n  file.path LIKE \"/Users/%/Downloads/%\"\n  -- Frequently targetted extension\
    \ for InfoStealer attacks\n  AND extension IN ('dmg', 'exe', 'pkg', 'rar')\n \
    \ AND (\n    file.filename LIKE \"%.app%\"\n    OR file.filename LIKE \"%Adobe\
    \ Photoshop%\"\n    OR file.filename LIKE \"%Advertising%\"\n    OR file.filename\
    \ LIKE \"%agreement%\"\n    OR file.filename LIKE \"%animated%\"\n    OR file.filename\
    \ LIKE \"%Brief%\"\n    OR file.filename LIKE \"%confidential%\"\n    OR file.filename\
    \ LIKE \"%confidentiality%\"\n    OR file.filename LIKE \"%conract%\"\n    OR\
    \ file.filename LIKE \"%contract%\"\n    OR file.filename LIKE \"%cover%\"\n \
    \   OR file.filename LIKE \"%crack%\"\n    OR file.filename LIKE \"%curriculum%\"\
    \n    OR file.filename LIKE \"%cv\"\n    OR file.filename LIKE \"%description%\"\
    \n    OR file.filename LIKE \"%Flash%\"\n    OR file.filename LIKE \"%freyavr%\"\
    \n    OR file.filename LIKE \"%game%\"\n    OR file.filename LIKE \"%immediate%\"\
    \n    OR file.filename LIKE \"%logos%\"\n    OR file.filename LIKE \"%official%\"\
    \n    OR file.filename LIKE \"%pdf%\"\n    OR file.filename LIKE \"%Player%\"\n\
    \    OR file.filename LIKE \"%poster%\"\n    OR file.filename LIKE \"%presentation%\"\
    \n    OR file.filename LIKE \"%receipt%\"\n    OR file.filename LIKE \"%reference%\"\
    \n    OR file.filename LIKE \"%resume%\"\n    OR file.filename LIKE \"%secret%\"\
    \n    OR file.filename LIKE \"%terms%\"\n    OR file.filename LIKE \"%trading%\"\
    \n    OR file.filename LIKE \"%Update%\"\n    OR file.filename LIKE \"%weed%\"\
    \n    OR file.filename LIKE \"cv%\"\n  )\n  -- False positives\n  AND NOT (\n\
    \    file.filename = \"googlesoftwareupdate.dmg\"\n    OR file.filename LIKE 'CalDigit_%_PD_Firmware_Updater_v%_Mac.dmg'\n\
    \    OR file.filename LIKE 'PA Lottery Player Location Check%.dmg'\n    OR file.filename\
    \ LIKE 'TS%-Thunderbolt-Firmware-Updater-Uninstaller.dmg'\n    OR file.filename\
    \ LIKE \"%MacVim%.dmg\"\n    OR file.filename LIKE \"LogiPresentation%.dmg\"\n\
    \    OR file.filename LIKE \"pdftk_server-%-win-setup.exe\"\n    OR file.filename\
    \ LIKE \"PioneerDriveUpdaterBDR%.dmg\"\n  )\n  -- Likely-safe download sources\n\
    \  AND NOT (\n    download_url LIKE 'https://definitionupdates.microsoft.com/%'\
    \ -- https://learn.microsoft.com/en-us/windows/privacy/manage-windows-11-endpoints#:~:text=TLSv1.2-,definitionupdates,-.microsoft.com\n\
    \    OR download_url LIKE 'https://myaccount.draftkings.com/%'\n    OR download_url\
    \ LIKE 'https://prod-downloads.geocomply.com/%'\n    OR download_url LIKE 'https://%.bose.com/%'\n\
    \  )\nGROUP BY\n  file.filename\n"
  platform: darwin
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
