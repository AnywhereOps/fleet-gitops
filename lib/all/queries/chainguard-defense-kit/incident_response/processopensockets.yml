---
apiVersion: v1
kind: query
spec:
  name: CDK - Process Open Sockets
  description: Return the list of open sockets per process
  query: |
    SELECT
      p.path AS p_path,
      p.name AS p_name,
      p.start_time AS p_time,
      p.euid AS p_euid,
      p.uid AS p_uid,
      p.cmdline AS p_cmdline,
      pos.*
    FROM
      process_open_sockets AS pos
      LEFT JOIN processes p ON pos.pid = p.pid;
  interval: 3600
  logging: snapshot
  observer_can_run: true
  automations_enabled: false
  discard_data: false
