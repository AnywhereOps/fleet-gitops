---
apiVersion: v1
kind: query
spec:
  name: CDK - Unexpected Etc Hosts
  description: Unexpected /etc/hosts entries
  query: |
    SELECT
      *
    FROM
      etc_hosts
    WHERE
      hostnames NOT IN (
        'ip6-allnodes',
        'ip6-allrouters',
        'kubernetes',
        'localhost ip6-localhost ip6-loopback',
        'localhost localhost.localdomain localhost4 localhost4.localdomain4',
        'localhost'
      )
      AND address NOT IN (
        '::1',
        'ff02::1',
        'ff02::2',
        '255.255.255.255',
        'fe00::0',
        'ff00::0'
      )
      AND address NOT LIKE '127.%'
      AND address NOT LIKE '172.%'
      AND address NOT LIKE '192.168.%'
      AND address NOT LIKE '10.%'
      AND hostnames NOT LIKE '%.%-%.%.dev'
      AND hostnames NOT LIKE '%.internal'
      AND hostnames NOT LIKE '%.local'
      AND hostnames NOT LIKE '%.svc'
      AND hostnames NOT LIKE '%.test'
      AND hostnames NOT LIKE '%.wtf'
      AND hostnames NOT LIKE '%k8s%'
      AND hostnames NOT LIKE '%local%'
      AND hostnames NOT LIKE 'ip6-%'
      AND hostnames NOT LIKE 'localhost.%'
      AND hostnames NOT LIKE "%.cloud"
      AND hostnames NOT LIKE "%.example.com"
  interval: 3600
  logging: snapshot
  observer_can_run: true
  automations_enabled: false
  discard_data: false
