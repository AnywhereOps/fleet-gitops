---
apiVersion: v1
kind: query
spec:
  name: Get applications hogging memory
  platform: darwin, linux, windows
  description: Returns top 10 applications or processes hogging memory the most.
  query: SELECT pid, name, ROUND((total_size * '10e-7'), 2) AS memory_used FROM processes ORDER BY total_size DESC LIMIT 10;
  powershell: |-
    $processes = Get-Process | Sort-Object WorkingSet64 -Descending | Select-Object -First 10
    $results = $processes | Select-Object @{Name="pid";Expression={$_.Id}},
                                   @{Name="name";Expression={$_.ProcessName}},
                                   @{Name="memory_used";Expression={[math]::Round($_.WorkingSet64 * 10e-7, 2)}}
    $results | Format-Table -AutoSize
  bash: echo "pid name memory_used"; ps -axo pid,comm,rss | sed 1d | sort -k3 -nr | head -n 10 | awk '{mem = $3*1024/1000000; printf "%s %s %.2f\n", $1, $2, mem}'
  purpose: Informational
  tags: troubleshooting
  contributors: DominusKelvin
