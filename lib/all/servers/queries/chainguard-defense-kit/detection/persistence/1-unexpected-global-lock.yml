- name: CDK - Unexpected Global Lock
  description: Find unexpected world readable run locks
  query: "SELECT\n  *,\n  CONCAT (\n    MIN(file.uid, 500),\n    \",\",\n    file.gid,\n\
    \    \",\",\n    file.path,\n    \",\",\n    file.type,\n    ',',\n    mode\n\
    \  ) AS exception_key\nFROM\n  file\nWHERE\n  (\n    path LIKE \"/dev/mqueue/.%.lock\"\
    \n    OR path LIKE \"/dev/mqueue/%.lock\"\n    OR path LIKE \"/dev/shm/.%.lock\"\
    \n    OR path LIKE \"/dev/shm/%.lock\"\n    OR path LIKE \"/tmp/.%.lock\"\n  \
    \  OR path LIKE \"/tmp/%.lock\"\n    OR path LIKE \"/var/run/.%.lock\"\n    OR\
    \ path LIKE \"/var/run/%.lock\"\n    OR path LIKE \"/var/tmp/.%.lock\"\n    OR\
    \ path LIKE \"/var/tmp/%.lock\"\n  )\n  AND exception_key NOT IN (\n    '0,0,/var/run/apport.lock,regular,0600',\n\
    \    '0,0,/var/run/dnf-metadata.lock,regular,0644',\n    '0,0,/var/run/ublue-update.lock,regular,0755',\n\
    \    '0,0,/var/run/ufw.lock,regular,0644',\n    '0,0,/var/run/unattended-upgrades.lock,regular,0640',\n\
    \    '0,0,/var/run/uupd.lock,regular,0644',\n    '0,0,/var/run/xtables.lock,regular,0600',\n\
    \    '0,1,/var/run/prl_desktop_services.lock,regular,0644',\n    '0,1,/var/run/prl_desktop_services_foreground.lock,regular,0644',\n\
    \    '0,1,/var/run/VMware Fusion Services.lock,regular,0600',\n    '0,1,/var/run/xv-update-resolv-conf.lock,regular,0600',\n\
    \    '0,1001,/var/run/keyd.socket.lock,regular,0600',\n    '500,0,/tmp/mysql.sock.lock,regular,0600',\n\
    \    '500,0,/tmp/mysqlx.sock.lock,regular,0600',\n    '500,0,/tmp/write.lock,regular,0644',\n\
    \    '500,1000,/tmp/1000-nwg-bar.lock,regular,0600',\n    '500,1000,/tmp/golangci-lint.lock,regular,0600',\n\
    \    '500,1000,/tmp/minecraftlauncher.1000.pid.lock,regular,0664',\n    '500,1001,/tmp/nwg-dock.lock,regular,0600',\n\
    \    '74,0,/tmp/mysql.sock.lock,regular,0600',\n    '74,0,/tmp/mysqlx.sock.lock,regular,0600'\n\
    \  )\n  AND NOT exception_key LIKE '500,0,/tmp/.s.PGSQL.%.lock,regular,0600'\n\
    \  AND NOT exception_key LIKE '500,1000,/tmp/keepassxc-%.lock,regular,0644'\n\
    \  AND NOT exception_key LIKE '500,1000,/tmp/keepassxc-%.lock,regular,0664'\n\
    \  AND NOT exception_key LIKE '500,1000,/tmp/vscode-remote-ssh-%-install.lock,regular,0664'\n\
    \  AND NOT exception_key LIKE '500,1000,/tmp/%.eksctl.lock,regular,0600'\n  AND\
    \ NOT exception_key LIKE '500,1000,/dev/shm/lsp-catalog-%.lock,regular,0664'\n\
    \  AND NOT exception_key LIKE '500,0,/tmp/uv-%.lock,regular,0777'\n  AND NOT exception_key\
    \ LIKE '500,1000,/tmp/uv-%.lock,regular,0777'\n"
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
