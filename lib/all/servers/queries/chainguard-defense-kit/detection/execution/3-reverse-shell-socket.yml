- name: CDK - Reverse Shell Socket
  description: 'Uncover reverse-shell processes refs: * https://www.invicti.com/blog/web-security/understanding-reverse-shells/
    * https://attack.mitre.org/techniques/T1059/ (Command & Scripting Interpreter)
    false-positives: * none known'
  query: "SELECT DISTINCT\n  (p.pid),\n  p.parent,\n  p.name,\n  p.path,\n  p.cmdline,\n\
    \  p.cwd,\n  p.root,\n  p.uid,\n  p.gid,\n  p.start_time,\n  pos.remote_address,\n\
    \  pos.remote_port,\n  pos.local_address,\n  pos.local_port,\n  pp.cmdline,\n\
    \  pp.path\nFROM\n  process_open_files pof\n  JOIN process_open_sockets pos USING\
    \ (pid)\n  LEFT JOIN processes p ON pof.pid = p.pid\n  LEFT JOIN processes pp\
    \ ON p.parent = pp.pid\n  LEFT OUTER JOIN process_open_files ON p.pid = process_open_files.pid\n\
    WHERE\n  p.name IN ('sh', 'bash', 'perl', 'python')\n  AND pof.pid IS NULL\n \
    \ AND pos.remote_port > 0\n  AND NOT (\n    p.path = '/usr/bin/bash'\n    AND\
    \ pp.cmdline LIKE 'pacman -S%'\n  )\n"
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
