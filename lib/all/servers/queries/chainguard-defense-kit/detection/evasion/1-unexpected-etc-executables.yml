- name: CDK - Unexpected Etc Executables
  description: Find unexpected executables in /etc
  query: "SELECT\n  file.path,\n  file.directory,\n  uid,\n  gid,\n  mode,\n  file.mtime,\n\
    \  file.size,\n  hash.sha256,\n  magic.data\nFROM\n  file\n  LEFT JOIN hash on\
    \ file.path = hash.path\n  LEFT JOIN magic ON file.path = magic.path\nWHERE\n\
    \  (file.path LIKE '/etc/%%')\n  AND file.type = 'regular'\n  AND (\n    file.mode\
    \ LIKE '%7%'\n    or file.mode LIKE '%5%'\n    or file.mode LIKE '%1%'\n  )\n\
    \  AND file.directory NOT IN (\n    '/etc/acpi',\n    '/etc/acpi/actions',\n \
    \   '/etc/alternatives',\n    '/etc/ansible/facts.d',\n    '/etc/apcupsd',\n \
    \   '/etc/apk/commit_hooks.d',\n    '/etc/apm/resume.d',\n    '/etc/apm/scripts.d',\n\
    \    '/etc/apm/suspend.d',\n    '/etc/asciidoc/filters/code',\n    '/etc/avahi',\n\
    \    '/etc/bash_completion.d',\n    '/etc/brltty/Contraction',\n    '/etc/ca-certificates/update.d',\n\
    \    '/etc/chromium/native-messaging-hosts',\n    '/etc/cifs-utils',\n    '/etc/cloud/clean.d/99-installer-use-networkmanager',\n\
    \    '/etc/console-setup',\n    '/etc/cron.daily',\n    '/etc/cron.hourly',\n\
    \    '/etc/cron.monthly',\n    '/etc/cron.weekly',\n    '/etc/dconf/db/distro.d',\n\
    \    '/etc/dconf/db/distro.d/locks',\n    '/etc/dhcp/dhclient-enter-hooks.d',\n\
    \    '/etc/dhcp/dhclient-exit-hooks.d',\n    '/etc/dhcp/dhclient.d',\n    '/etc/distrobox',\n\
    \    '/etc/dkms',\n    '/etc/etckeeper/commit.d',\n    '/etc/flatpak/remotes.d',\n\
    \    '/etc/framework-ectool',\n    '/etc/fstab.script',\n    '/etc/gdm',\n   \
    \ '/etc/gdm/Init',\n    '/etc/gdm/PostLogin',\n    '/etc/gdm/PostSession',\n \
    \   '/etc/gdm/PreSession',\n    '/etc/gdm3',\n    '/etc/gdm3/Init',\n    '/etc/gdm3/PostLogin',\n\
    \    '/etc/gdm3/PostSession',\n    '/etc/gdm3/PreSession',\n    '/etc/gdm3/Prime',\n\
    \    '/etc/gdm3/PrimeOff',\n    '/etc/grub.d',\n    '/etc/httpd/modules',\n  \
    \  '/etc/ifplugd',\n    '/etc/ifplugd/action.d',\n    '/etc/init.d',\n    '/etc/initramfs/post-update.d',\n\
    \    '/etc/kde/shutdown',\n    '/etc/kernel/header_postinst.d',\n    '/etc/kernel/install.d',\n\
    \    '/etc/kernel/postinst.d',\n    '/etc/kernel/postrm.d',\n    '/etc/kernel/preinst.d',\n\
    \    '/etc/kernel/prerm.d',\n    '/etc/lightdm',\n    '/etc/localtime',\n    '/etc/mc',\n\
    \    '/etc/mcelog/triggers',\n    '/etc/menu-methods',\n    '/etc/needrestart/hook.d',\n\
    \    '/etc/needrestart/notify.d',\n    '/etc/needrestart/restart.d',\n    '/etc/network',\n\
    \    '/etc/network/if-down.d',\n    '/etc/network/if-post-down.d',\n    '/etc/network/if-pre-up.d',\n\
    \    '/etc/network/if-up.d',\n    '/etc/NetworkManager/dispatcher.d',\n    '/etc/nix/result',\n\
    \    '/etc/nix/result/sw/bin',\n    '/etc/openvpn',\n    '/etc/periodic/daily',\n\
    \    '/etc/periodic/monthly',\n    '/etc/periodic/weekly',\n    '/etc/pinentry',\n\
    \    '/etc/pki/tls/misc',\n    '/etc/pm/sleep.d',\n    '/etc/pop-os/update-motd.d',\n\
    \    '/etc/ppp',\n    '/etc/ppp/ip-down.d',\n    '/etc/ppp/ip-up.d',\n    '/etc/ppp/ipv6-up.d',\n\
    \    '/etc/profile.d',\n    '/etc/qemu-ga',\n    '/etc/rc.d/init.d',\n    '/etc/rc.d/rc0.d',\n\
    \    '/etc/rc.d/rc1.d',\n    '/etc/rc.d/rc2.d',\n    '/etc/rc.d/rc3.d',\n    '/etc/rc.d/rc4.d',\n\
    \    '/etc/rc.d/rc5.d',\n    '/etc/rc.d/rc6.d',\n    '/etc/rc0.d',\n    '/etc/rc1.d',\n\
    \    '/etc/rc2.d',\n    '/etc/rc3.d',\n    '/etc/rc4.d',\n    '/etc/rc5.d',\n\
    \    '/etc/rc6.d',\n    '/etc/rcS.d',\n    '/etc/rdnssd',\n    '/etc/redhat-lsb',\n\
    \    '/etc/resolvconf/update-libc.d',\n    '/etc/resolvconf/update.d',\n    '/etc/runit',\n\
    \    '/etc/schroot/setup.d',\n    '/etc/security',\n    '/etc/skel',\n    '/etc/smartmontools',\n\
    \    '/etc/smartmontools/run.d',\n    '/etc/ssl/certs',\n    '/etc/ssl/misc',\n\
    \    '/etc/ssl/trust-source',\n    '/etc/sv/dnsmasq',\n    '/etc/sv/dnsmasq/log',\n\
    \    '/etc/sv/incus',\n    '/etc/sv/incus-user',\n    '/etc/sv/incus-user/log',\n\
    \    '/etc/sv/pcscd',\n    '/etc/sv/pcscd/control',\n    '/etc/sv/pcscd/log',\n\
    \    '/etc/sv/svlogd',\n    '/etc/sysconfig/network-scripts',\n    '/etc/systemd/system',\n\
    \    '/etc/systemd/system-shutdown',\n    '/etc/systemd/system/graphical.target.wants',\n\
    \    '/etc/timeshift/restore-hooks.d',\n    '/etc/udev/rules.d',\n    '/etc/update-motd.d',\n\
    \    '/etc/vmware-tools',\n    '/etc/vmware-tools/scripts/vmware',\n    '/etc/vpnc',\n\
    \    '/etc/wpa_supplicant',\n    '/etc/X11',\n    '/etc/X11/xinit',\n    '/etc/X11/xinit/xinitrc.d',\n\
    \    '/etc/xdg/Xwayland-session.d',\n    '/etc/zfs-fuse',\n    '/etc/zfs/zed.d',\n\
    \    '/etc/zfs/zpool.d'\n  )\n  AND file.path NOT IN (\n    '/etc/auto.net',\n\
    \    '/etc/auto.smb',\n    '/etc/cloud/clean.d/99-installer',\n    '/etc/cloud/clean.d/99-installer-use-networkmanager',\n\
    \    '/etc/cron.yearly/0anacron',\n    '/etc/fstab.script',\n    '/etc/grub2-efi.cfg',\n\
    \    '/etc/grub2.cfg',\n    '/etc/hibernate.sh',\n    '/etc/libpaper.d/texlive-base',\n\
    \    '/etc/macchanger/ifupdown.sh',\n    '/etc/modulefiles/vpl',\n    '/etc/nftables.conf',\n\
    \    '/etc/opt/chrome/native-messaging-hosts/com.google.endpoint_verification.api_helper.json',\n\
    \    '/etc/paths.d/100-rvictl',\n    '/etc/pcp/pmcd/rc.local',\n    '/etc/pcp/pmie/rc',\n\
    \    '/etc/pcp/pmlogger/rc',\n    '/etc/pcp/pmproxy/rc',\n    '/etc/pki/tls/certs/make-dummy-cert',\n\
    \    '/etc/pki/tls/certs/renew-dummy-cert',\n    '/etc/postfix/post-install',\n\
    \    '/etc/postfix/postfix-script',\n    '/etc/profile',\n    '/etc/pwrstatd.conf',\n\
    \    '/etc/qemu-ifdown',\n    '/etc/qemu-ifup',\n    '/etc/rmt',\n    '/etc/sddm/wayland-session',\n\
    \    '/etc/sddm/Xsession',\n    '/etc/sddm/Xsetup',\n    '/etc/sddm/Xstop',\n\
    \    '/etc/shutdown.sh',\n    '/etc/sudoers.d/lima',\n    '/etc/sv/ssh/finish',\n\
    \    '/etc/sv/ssh/log/run',\n    '/etc/sv/ssh/run',\n    '/etc/udev/powersave.sh',\n\
    \    '/etc/vpl/vars.sh',\n    '/etc/xdg/xfce4/xinitrc'\n  )\n  AND file.directory\
    \ NOT LIKE '/etc/asciidoc/%'\n  -- Nix (on macOS) -- actually a symbolic link\n\
    \  AND file.path NOT LIKE '/etc/etckeeper/%'\n  AND file.path NOT LIKE '/etc/profiles/per-user/%/bin/%'\n\
    \  AND file.path NOT LIKE '/etc/pwrstatd-%.sh'\n  AND file.path NOT LIKE '/etc/pwrstatd-%.sh'\n\
    \  AND file.path NOT LIKE '/etc/alternatives/%'\n  AND (\n    magic.data IS NULL\n\
    \    OR magic.data NOT IN ('JSON text data', 'ASCII text')\n  )\n"
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
