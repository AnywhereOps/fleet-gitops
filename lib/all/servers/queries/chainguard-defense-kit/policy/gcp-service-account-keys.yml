- name: CDK - Gcp Service Account Keys
  description: Indicative of stored GCP service account keys just sitting around unencrypted
  query: "SELECT\n  file.path,\n  file.filename,\n  file.type,\n  file.size,\n  file.mtime,\n\
    \  file.uid,\n  file.ctime,\n  file.gid,\n  hash.sha256,\n  magic.data\nFROM\n\
    \  file\n  LEFT JOIN hash ON file.path = hash.path\n  LEFT JOIN users u ON file.uid\
    \ = u.uid\n  LEFT JOIN magic ON file.path = magic.path\nWHERE\n  (\n    file.directory\
    \ LIKE '/Users/%/Downloads/%'\n    OR file.directory LIKE '/home/%/%'\n    OR\
    \ file.directory LIKE '/home/%/'\n    OR file.directory LIKE '/home/%/.%'\n  \
    \  OR file.directory LIKE '/home/%/Downloads/%'\n    OR file.directory LIKE '/tmp/%'\n\
    \    OR file.directory LIKE '/tmp/'\n    OR file.directory LIKE '/Users/%/%'\n\
    \    OR file.directory LIKE '/Users/%/'\n    OR file.directory LIKE '/Users/%/.%'\n\
    \    OR file.directory LIKE '/var/tmp/%'\n    OR file.directory LIKE '/var/tmp/'\n\
    \  )\n  AND file.directory NOT LIKE \"%/../%\"\n  AND file.directory NOT LIKE\
    \ \"%/./%\"\n  AND filename LIKE \"%-%-%.json\"\n  AND size BETWEEN 2311 AND 2385\n\
    \  -- Don't alert on tokens that begin with the username-, as they may be personal\n\
    \  AND NOT INSTR(filename, CONCAT (u.username, \"-\")) == 1\n  -- Don't alert\
    \ on tokens that begin with the users full name and a dash\n  AND NOT INSTR(\n\
    \    filename,\n    REPLACE(LOWER(TRIM(description)), \" \", \"-\")\n  ) == 1\n\
    \  -- Demo keys\n  AND NOT file.filename LIKE 'host-project-%'\n  AND NOT file.filename\
    \ LIKE 'ulabs-%'\n  AND NOT file.filename LIKE 'test-%'\n  AND NOT file.filename\
    \ LIKE 'demo-%'\n  AND NOT file.filename LIKE 'example-%'\n  AND NOT hash.sha256\
    \ IN (\n    \"c7d6bac8e942511e25973889ac38656d4d46f68044650d694721017fda23716e\"\
    ,\n    \"386bd767a15daa0659519bcb0b178826ef1579d1f0ec32f63ae01efc68e7889d\",\n\
    \    \"bd5f4c01ebb5636b94584ee4ae42514b27d371859f7344f6aa5a37332ee714ba\"\n  )\n"
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
