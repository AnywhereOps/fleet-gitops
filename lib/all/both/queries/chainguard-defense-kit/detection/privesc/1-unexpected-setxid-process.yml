- name: CDK - Unexpected Setxid Process
  description: 'Processes running that originate from setuid/setgid programs false-positives:
    * an unlisted setuid binary'
  query: "SELECT\n  p.pid,\n  p.name,\n  p.path,\n  p.cmdline,\n  f.ctime,\n  p.cwd,\n\
    \  p.uid,\n  f.mode,\n  hash.sha256\nFROM\n  processes p\n  JOIN file f ON p.path\
    \ = f.path\n  JOIN hash ON p.path = hash.path\nWHERE\n  f.mode NOT LIKE '0%'\n\
    \  AND f.path NOT IN (\n    '/Applications/Parallels Desktop.app/Contents/MacOS/Parallels\
    \ Service',\n    '/Applications/VMware Fusion.app/Contents/Library/vmware-vmx',\n\
    \    '/bin/ps',\n    '/Library/Application Support/Google/GoogleUpdater/Current/GoogleUpdater.app/Contents/Helpers/launcher',\n\
    \    '/Library/Application Support/org.pqrs/Karabiner-Elements/bin/karabiner_session_monitor',\n\
    \    '/Library/DropboxHelperTools/Dropbox_u501/dbkextd',\n    '/opt/1Password/1Password-BrowserSupport',\n\
    \    '/opt/1Password/1Password-KeyringHelper',\n    '/opt/Blockbench/chrome-sandbox',\n\
    \    '/opt/google/chrome/chrome-sandbox',\n    '/opt/IRCCloud/chrome-sandbox',\n\
    \    '/opt/zoom/cef/chrome-sandbox',\n    '/System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/MacOS/ARDAgent',\n\
    \    '/usr/bin/bwrap',\n    '/usr/bin/crontab',\n    '/usr/bin/doas',\n    '/usr/bin/fusermount',\n\
    \    '/usr/bin/fusermount3',\n    '/usr/bin/keybase-redirector',\n    '/usr/bin/login',\n\
    \    '/usr/bin/mount',\n    '/usr/bin/newgrp',\n    '/usr/bin/op',\n    '/usr/bin/passwd',\n\
    \    '/usr/bin/schroot',\n    '/usr/bin/ssh-agent',\n    '/usr/bin/su',\n    '/usr/bin/sudo',\n\
    \    '/usr/bin/top',\n    '/usr/lib/electron/chrome-sandbox',\n    '/usr/lib/electron22/chrome-sandbox',\n\
    \    '/usr/lib/opt/1Password/1Password-BrowserSupport',\n    '/usr/lib/polkit-1/polkit-agent-helper-1',\n\
    \    '/usr/lib/slack/chrome-sandbox',\n    '/usr/lib/xf86-video-intel-backlight-helper',\n\
    \    '/usr/lib/Xorg.wrap',\n    '/usr/sbin/traceroute'\n  )\n  AND f.filename\
    \ != 'chrome-sandbox'\n  AND f.path NOT LIKE '/Library/Application Support/Google/GoogleUpdater/1%/GoogleUpdater.app/Contents/Helpers/launcher'\n\
    \  AND f.path NOT LIKE '/opt/homebrew/Cellar/dnsmasq/%/sbin/dnsmasq'\n  AND f.path\
    \ NOT LIKE '/opt/homebrew/Cellar/socket_vmnet/%/bin/socket_vmnet'\n  AND f.path\
    \ NOT LIKE '/Users/%/homebrew/Cellar/socket_vmnet/%/bin/socket_vmnet'\n  AND f.path\
    \ NOT LIKE '/snap/snapd/%/usr/lib/snapd/snap-confine'\n"
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
