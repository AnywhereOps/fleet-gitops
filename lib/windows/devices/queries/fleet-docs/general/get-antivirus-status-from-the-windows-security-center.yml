---
apiVersion: v1
kind: query
spec:
  name: Get antivirus status from the Windows Security Center
  platform: windows
  description: Selects the antivirus and signatures status from Windows Security Center.
  query: SELECT antivirus, signatures_up_to_date from windows_security_center CROSS JOIN windows_security_products WHERE type = 'Antivirus';
  powershell: "$avProducts = Get-CimInstance -Namespace 'root\\SecurityCenter2' -ClassName AntiVirusProduct -ErrorAction SilentlyContinue $results = foreach ($av in $avProducts) {\n    # Extract signature\
    \ status from productState. Note: this interpretation may vary between AV products.\n    # The productState is a 32-bit integer. Shifting right 16 bits isolates the signature status.\n    $sigStatus\
    \ = ($av.productState -shr 16) -band 0xFF\n    # Conventionally, a value of 16 (0x10) indicates signatures are up to date.\n    $signaturesUpToDate = ($sigStatus -eq 16)\n    [PSCustomObject]@{\n  \
    \      antivirus              = $av.displayName\n        signatures_up_to_date  = $signaturesUpToDate\n    }\n} $results | Format-Table -AutoSize"
  purpose: Informational
  tags: compliance, malware, hardening, built-in
  contributors: GuillaumeRoss
  team: devices
