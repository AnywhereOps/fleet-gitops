- name: Operating system version (Windows)
  description: Retrieves operating system version information from a Windows device.
  query: "WITH display_version_table AS (\n      SELECT data as display_version\n\
    \      FROM registry\n      WHERE path = 'HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\
    \\Windows NT\\\\CurrentVersion\\\\DisplayVersion'\n    ),\n    ubr_table AS (\n\
    \      SELECT data AS ubr\n      FROM registry\n      WHERE path ='HKEY_LOCAL_MACHINE\\\
    \\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\UBR'\n    )\n    SELECT\n\
    \      os.name,\n      COALESCE(d.display_version, '') AS display_version,\n \
    \     COALESCE(CONCAT((SELECT version FROM os_version), '.', u.ubr), k.version)\
    \ AS version\n    FROM\n      os_version os,\n      kernel_info k\n    LEFT JOIN\n\
    \      display_version_table d\n    LEFT JOIN\n      ubr_table u\n"
  platform: windows
