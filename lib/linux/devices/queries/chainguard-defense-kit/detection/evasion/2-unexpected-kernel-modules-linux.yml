- name: CDK - Unexpected Kernel Modules Linux
  description: Find kernel modules that are not part of the expected list
  query: "SELECT\n  *\nFROM\n  kernel_modules\nWHERE\n  -- Filter out kernel modules\
    \ that are required by another kernel module to reduce false-positives\n  used_by\
    \ != NULL\n  AND name NOT IN (\n    '8021q',\n    'ac97_bus',\n    'acpi_cpufreq',\n\
    \    'acpi_pad',\n    'acpi_tad',\n    'acpi_thermal_rel',\n    'aesni_intel',\n\
    \    'af_alg',\n    'af_packet',\n    'agpgart',\n    'ahci',\n    'algif_aead',\n\
    \    'algif_hash',\n    'algif_skcipher',\n    'amd_pmc',\n    'amdgpu',\n   \
    \ 'apple_mfi_fastcharge',\n    'asn1_encoder',\n    'asus_ec_sensors',\n    'asus_wmi',\n\
    \    'ath',\n    'ath10k_core',\n    'ath10k_pci',\n    'atkbd',\n    'authenc',\n\
    \    'autofs4',\n    'backlight',\n    'battery',\n    'binfmt_misc',\n    'bluetooth',\n\
    \    'bnep',\n    'bpf_preload',\n    'br_netfilter',\n    'bridge',\n    'btbcm',\n\
    \    'btintel',\n    'btmtk',\n    'btrtl',\n    'btusb',\n    'button',\n   \
    \ 'cbc',\n    'ccm',\n    'ccp',\n    'cdc_ether',\n    'cdrom',\n    'cec',\n\
    \    'cfg80211',\n    'cmac',\n    'configfs',\n    'coretemp',\n    'cpuid',\n\
    \    'cqhci',\n    'crc_t10dif',\n    'crc16',\n    'crc32_pclmul',\n    'crc32c_generic',\n\
    \    'crc32c_intel',\n    'crct10dif_common',\n    'crct10dif_generic',\n    'crct10dif_pclmul',\n\
    \    'cros_ec_chardev',\n    'cros_ec_debugfs',\n    'cros_ec_dev',\n    'cros_ec_ishtp',\n\
    \    'cros_ec_lpcs',\n    'cros_ec_sysfs',\n    'cros_ec',\n    'cros_usbpd_charger',\n\
    \    'cros_usbpd_logger',\n    'cros_usbpd_notify',\n    'cryptd',\n    'crypto_simd',\n\
    \    'crypto_user',\n    'ctr',\n    'dca',\n    'dcdbas',\n    'deflate',\n \
    \   'dell_laptop',\n    'dell_smbios',\n    'dell_smm_hwmon',\n    'dell_wmi_descriptor',\n\
    \    'dell_wmi',\n    'des_generic',\n    'dm_bio_prison',\n    'dm_bufio',\n\
    \    'dm_crypt',\n    'dm_mod',\n    'dm_multipath',\n    'dm_persistent_data',\n\
    \    'dm_thin_pool',\n    'drm_buddy',\n    'drm_display_helper',\n    'drm_dp_helper',\n\
    \    'drm_kms_helper',\n    'drm_ttm_helper',\n    'drm',\n    'ecb',\n    'ecc',\n\
    \    'ecdh_generic',\n    'edac_core',\n    'edac_mce_amd',\n    'ee1004',\n \
    \   'eeepc_wmi',\n    'efi_pstore',\n    'efivarfs',\n    'encrypted_keys',\n\
    \    'essiv',\n    'evdev',\n    'exfat',\n    'ext4',\n    'fat',\n    'fb_sys_fops',\n\
    \    'firmware_attributes_class',\n    'fuse',\n    'garmin_gps',\n    'gf128mul',\n\
    \    'ghash_clmulni_intel',\n    'gigabyte_wmi',\n    'gpio_amdpt',\n    'gpio_generic',\n\
    \    'gpu_sched',\n    'hid_apple',\n    'hid_generic',\n    'hid_jabra',\n  \
    \  'hid_logitech_dj',\n    'hid_logitech_hidpp',\n    'hid_multitouch',\n    'hid_sensor_als',\n\
    \    'hid_sensor_custom',\n    'hid_sensor_hub',\n    'hid_sensor_iio_common',\n\
    \    'hid_sensor_trigger',\n    'hid',\n    'hwmon_vid',\n    'i2c_algo_bit',\n\
    \    'i2c_core',\n    'i2c_designware_core',\n    'i2c_designware_platform',\n\
    \    'i2c_hid_acpi',\n    'i2c_hid',\n    'i2c_i801',\n    'i2c_piix4',\n    'i2c_scmi',\n\
    \    'i2c_smbus',\n    'i8042',\n    'i915',\n    'icp',\n    'idma64',\n    'igb',\n\
    \    'igc',\n    'igen6_edac',\n    'industrialio_triggered_buffer',\n    'industrialio',\n\
    \    'input_leds',\n    'int3400_thermal',\n    'int3403_thermal',\n    'int340x_thermal_zone',\n\
    \    'intel_cstate',\n    'intel_gtt',\n    'intel_hid',\n    'intel_ish_ipc',\n\
    \    'intel_ishtp_hid',\n    'intel_ishtp_loader',\n    'intel_ishtp',\n    'intel_lpss_pci',\n\
    \    'intel_lpss',\n    'intel_pch_thermal',\n    'intel_pmc_bxt',\n    'intel_pmt',\n\
    \    'intel_powerclamp',\n    'intel_rapl_common',\n    'intel_rapl_msr',\n  \
    \  'intel_soc_dts_iosf',\n    'intel_spi_pci',\n    'intel_spi',\n    'intel_tcc_cooling',\n\
    \    'intel_uncore',\n    'intel_vsec',\n    'intel_wmi_thunderbolt',\n    'intel_xhci_usb_role_switch',\n\
    \    'iommu_v2',\n    'ip_set',\n    'ip_tables',\n    'ip_vs_rr',\n    'ip_vs_sh',\n\
    \    'ip_vs_wrr',\n    'ip_vs',\n    'ip6_tables',\n    'ip6t_REJECT',\n    'ip6t_rpfilter',\n\
    \    'ip6t_rt',\n    'ip6table_filter',\n    'ip6table_mangle',\n    'ip6table_nat',\n\
    \    'ip6table_raw',\n    'ip6table_security',\n    'ipheth',\n    'ipmi_devintf',\n\
    \    'ipmi_msghandler',\n    'ipt_REJECT',\n    'ipt_rpfilter',\n    'iptable_filter',\n\
    \    'iptable_mangle',\n    'iptable_nat',\n    'iptable_raw',\n    'iptable_security',\n\
    \    'irqbypass',\n    'isofs',\n    'iTCO_vendor_support',\n    'iTCO_wdt',\n\
    \    'iwlmei',\n    'iwlmvm',\n    'iwlwifi',\n    'jbd2',\n    'jc42',\n    'joydev',\n\
    \    'k10temp',\n    'kfifo_buf',\n    'kvm_amd',\n    'kvm_intel',\n    'kvm',\n\
    \    'led_class',\n    'ledtrig_audio',\n    'libaes',\n    'libahci',\n    'libarc4',\n\
    \    'libata',\n    'libcrc32c',\n    'libdes',\n    'libphy',\n    'libps2',\n\
    \    'llc',\n    'loop',\n    'lp',\n    'mac_hid',\n    'mac80211',\n    'macvlan',\n\
    \    'mbcache',\n    'mc',\n    'md_mod',\n    'md4',\n    'mdio_devres',\n  \
    \  'mei_hdcp',\n    'mei_me',\n    'mei_pxp',\n    'mei_wdt',\n    'mei',\n  \
    \  'mii',\n    'mmc_block',\n    'mmc_core',\n    'mousedev',\n    'msr',\n  \
    \  'mtd',\n    'mxm_wmi',\n    'nct6775_core',\n    'nct6775',\n    'netlink_diag',\n\
    \    'nf_conntrack_broadcast',\n    'nf_conntrack_netbios_ns',\n    'nf_conntrack_netlink',\n\
    \    'nf_conntrack',\n    'nf_defrag_ipv4',\n    'nf_defrag_ipv6',\n    'nf_log_syslog',\n\
    \    'nf_nat',\n    'nf_reject_ipv4',\n    'nf_reject_ipv6',\n    'nf_tables',\n\
    \    'nfnetlink_log',\n    'nfnetlink_queue',\n    'nfnetlink',\n    'nft_chain_nat',\n\
    \    'nft_compat',\n    'nft_counter',\n    'nft_ct',\n    'nft_fib_inet',\n \
    \   'nft_fib_ipv4',\n    'nft_fib_ipv6',\n    'nft_fib',\n    'nft_limit',\n \
    \   'nft_objref',\n    'nft_reject_inet',\n    'nft_reject',\n    'nls_cp437',\n\
    \    'nls_iso8859_1',\n    'nvidia_drm',\n    'nvidia_modeset',\n    'nvidia_uvm',\n\
    \    'nvidia',\n    'nvme_common',\n    'nvme_core',\n    'nvme',\n    'nvram',\n\
    \    'overlay',\n    'parport_pc',\n    'parport',\n    'pcspkr',\n    'pinctrl_amd',\n\
    \    'pinctrl_sunrisepoint',\n    'pinctrl_tigerlake',\n    'pkcs8_key_parser',\n\
    \    'platform_profile',\n    'pmt_class',\n    'pmt_telemetry',\n    'polyval_clmulni',\n\
    \    'polyval_generic',\n    'ppdev',\n    'pps_core',\n    'processor_thermal_device_pci_legacy',\n\
    \    'processor_thermal_device_pci',\n    'processor_thermal_device',\n    'processor_thermal_mbox',\n\
    \    'processor_thermal_rapl',\n    'processor_thermal_rfim',\n    'psmouse',\n\
    \    'pstore_blk',\n    'pstore_zone',\n    'pstore',\n    'ptp',\n    'qrtr',\n\
    \    'r8152',\n    'r8153_ecm',\n    'r8169',\n    'raid0',\n    'ramoops',\n\
    \    'rapl',\n    'raydium_i2c_ts',\n    'rc_core',\n    'realtek',\n    'reed_solomon',\n\
    \    'rfcomm',\n    'rfkill',\n    'rndis_host',\n    'rndis_wlan',\n    'rng_core',\n\
    \    'roles',\n    'rtc_cmos',\n    'rtsx_pci_sdmmc',\n    'rtsx_pci',\n    'rtw89_8852a',\n\
    \    'rtw89_8852ae',\n    'rtw89_core',\n    'rtw89_pci',\n    'sch_fq_codel',\n\
    \    'scsi_common',\n    'scsi_mod',\n    'sdhci_pci',\n    'sdhci',\n    'serio_raw',\n\
    \    'serio',\n    'sg',\n    'snd_acp_config',\n    'snd_acp3x_pdm_dma',\n  \
    \  'snd_acp3x_rn',\n    'snd_compress',\n    'snd_ctl_led',\n    'snd_hda_codec_generic',\n\
    \    'snd_hda_codec_hdmi',\n    'snd_hda_codec_idt',\n    'snd_hda_codec_realtek',\n\
    \    'snd_hda_codec',\n    'snd_hda_core',\n    'snd_hda_ext_core',\n    'snd_hda_intel',\n\
    \    'snd_hrtimer',\n    'snd_hwdep',\n    'snd_intel_dspcfg',\n    'snd_intel_sdw_acpi',\n\
    \    'snd_pci_acp3x',\n    'snd_pci_acp5x',\n    'snd_pci_acp6x',\n    'snd_pcm_dmaengine',\n\
    \    'snd_pcm',\n    'snd_rawmidi',\n    'snd_rn_pci_acp3x',\n    'snd_seq_device',\n\
    \    'snd_seq_dummy',\n    'snd_seq_midi_event',\n    'snd_seq_midi',\n    'snd_seq',\n\
    \    'snd_soc_acpi_intel_match',\n    'snd_soc_acpi',\n    'snd_soc_avs',\n  \
    \  'snd_soc_core',\n    'snd_soc_dmic',\n    'snd_soc_hda_codec',\n    'snd_soc_hdac_hda',\n\
    \    'snd_soc_hdac_hdmi',\n    'snd_soc_intel_hda_dsp_common',\n    'snd_soc_skl_hda_dsp',\n\
    \    'snd_soc_skl',\n    'snd_soc_sst_dsp',\n    'snd_soc_sst_ipc',\n    'snd_sof_amd_acp',\n\
    \    'snd_sof_amd_renoir',\n    'snd_sof_intel_hda_common',\n    'snd_sof_intel_hda',\n\
    \    'snd_sof_pci_intel_tgl',\n    'snd_sof_pci',\n    'snd_sof_utils',\n    'snd_sof_xtensa_dsp',\n\
    \    'snd_sof',\n    'snd_timer',\n    'snd_usb_audio',\n    'snd_usbmidi_lib',\n\
    \    'snd',\n    'soundcore',\n    'soundwire_bus',\n    'soundwire_cadence',\n\
    \    'soundwire_generic_allocation',\n    'soundwire_intel',\n    'sp5100_tco',\n\
    \    'sparse_keymap',\n    'spi_intel_pci',\n    'spi_intel',\n    'spi_nor',\n\
    \    'spl',\n    'squashfs',\n    'stp',\n    'sunrpc',\n    'syscopyarea',\n\
    \    'sysfillrect',\n    'sysimgblt',\n    't10_pi',\n    'tap',\n    'tee',\n\
    \    'thermal',\n    'think_lmi',\n    'thinkpad_acpi',\n    'thunderbolt',\n\
    \    'tiny_power_button',\n    'tls',\n    'tpm_crb',\n    'tpm_tis_core',\n \
    \   'tpm_tis',\n    'tpm',\n    'trusted',\n    'ttm',\n    'tun',\n    'typec_ucsi',\n\
    \    'typec',\n    'uas',\n    'ucsi_acpi',\n    'uhid',\n    'uinput',\n    'usb_common',\n\
    \    'usb_storage',\n    'usbcore',\n    'usbhid',\n    'usbnet',\n    'uvcvideo',\n\
    \    'v4l2loopback',\n    'veth',\n    'vfat',\n    'video',\n    'videobuf2_common',\n\
    \    'videobuf2_memops',\n    'videobuf2_v4l2',\n    'videobuf2_vmalloc',\n  \
    \  'videodev',\n    'vivaldi_fmap',\n    'watchdog',\n    'wmi_bmof',\n    'wmi',\n\
    \    'x_tables',\n    'x86_pkg_temp_thermal',\n    'xfrm_algo',\n    'xfrm_user',\n\
    \    'xfs',\n    'xhci_hcd',\n    'xhci_pci_renesas',\n    'xhci_pci',\n    'xt_addrtype',\n\
    \    'xt_comment',\n    'xt_conntrack',\n    'xt_hl',\n    'xt_limit',\n    'xt_LOG',\n\
    \    'xt_mark',\n    'xt_MASQUERADE',\n    'xt_nat',\n    'xt_pkttype',\n    'xt_statistic',\n\
    \    'xt_tcpudp',\n    'zavl',\n    'zcommon',\n    'zfs',\n    'zlua',\n    'znvpair',\n\
    \    'zram',\n    'zunicode',\n    'zzstd'\n  )\n"
  platform: linux
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
