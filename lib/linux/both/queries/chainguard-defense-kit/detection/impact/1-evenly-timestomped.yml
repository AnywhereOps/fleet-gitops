- name: CDK - Evenly Timestomped
  description: Files where the timestamp falls along 12-hour boundaries - probably
    caused by 'touch <date>0000'
  query: "SELECT\n  file.path,\n  DATETIME(file.mtime, 'unixepoch', 'localtime') AS\
    \ mod_time,\n  DATETIME(file.atime, 'unixepoch', 'localtime') AS access_time,\n\
    \  file.inode,\n  file.type,\n  file.mode,\n  hash.sha256,\n  magic.data\nFROM\n\
    \  file\n  LEFT JOIN hash ON file.path = hash.path\n  LEFT JOIN magic ON file.path\
    \ = magic.path\nWHERE\n  (\n    file.path LIKE \"/bin/%%\"\n    OR file.path LIKE\
    \ \"/etc/%%\"\n    OR file.path LIKE \"/sbin/%%\"\n    OR file.path LIKE \"/lib/%%\"\
    \n  )\n  -- This timestamp is in UTC\n  AND file.mtime > (strftime('%s', 'now')\
    \ - (86400 * 720))\n  AND file.mtime % 3600 = 0\n  AND file.type = 'regular'\n\
    \  -- Narrow down to specific offsets in the users local timezone (there should\
    \ be a better way!)\n  AND (\n    mod_time LIKE \"% 12:00:00\"\n    OR mod_time\
    \ LIKE \"% 00:00:00\"\n  )\n  -- false positives\n  AND filename NOT IN (\n  \
    \  '_libinput',\n    'COPYING',\n    'debian_version',\n    'installer-info.json',\n\
    \    'master.passwd',\n    'METADATA',\n    'NEWS',\n    'printcap',\n    'strace-log-merge'\n\
    \  )\n  AND filename NOT LIKE '%.txt'\n  AND file.path NOT LIKE '/etc/cups/%'\n\
    \  AND file.path NOT LIKE '%/lynis%'\n  AND file.path NOT LIKE '%/yelp-xsl%'\n\
    \  AND file.path != '/bin/VGAuthService'\n"
  platform: linux
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
