- name: CDK - Unexpected Process Extension Linux
  description: Processes that have an unusual extension
  query: "SELECT\n  -- Child\n  p0.pid AS p0_pid,\n  p0.path AS p0_path,\n  p0.name\
    \ AS p0_name,\n  p0.start_time AS p0_start,\n  p0.cmdline AS p0_cmd,\n  p0.cwd\
    \ AS p0_cwd,\n  REGEX_MATCH (p0.path, '.*\\/(.*?)$', 1) AS basename,\n  REGEX_MATCH\
    \ (p0.path, '.*\\.(\\w+)$', 1) AS extension,\n  p0.cgroup_path AS p0_cgroup,\n\
    \  p0.euid AS p0_euid,\n  p0_hash.sha256 AS p0_sha256,\n  -- Parent\n  p0.parent\
    \ AS p1_pid,\n  p1.path AS p1_path,\n  p1.name AS p1_name,\n  p1.start_time AS\
    \ p1_start,\n  p1.euid AS p1_euid,\n  p1.cmdline AS p1_cmd,\n  p1_hash.sha256\
    \ AS p1_sha256,\n  -- Grandparent\n  p1.parent AS p2_pid,\n  p2.name AS p2_name,\n\
    \  p2.start_time AS p2_start,\n  p2.path AS p2_path,\n  p2.cmdline AS p2_cmd,\n\
    \  p2_hash.sha256 AS p2_sha256\nFROM\n  processes p0\n  LEFT JOIN hash p0_hash\
    \ ON p0.path = p0_hash.path\n  LEFT JOIN processes p1 ON p0.parent = p1.pid\n\
    \  LEFT JOIN hash p1_hash ON p1.path = p1_hash.path\n  LEFT JOIN processes p2\
    \ ON p1.parent = p2.pid\n  LEFT JOIN hash p2_hash ON p2.path = p2_hash.path\n\
    WHERE\n  extension IS NOT NULL\n  AND extension NOT IN (\n    '0',\n    '1',\n\
    \    '2',\n    '3',\n    '4',\n    '5',\n    '7',\n    '10',\n    '11',\n    '12',\n\
    \    '13',\n    '14',\n    '15',\n    '16',\n    '17',\n    '18',\n    '19',\n\
    \    '20',\n    '21',\n    '22',\n    '23',\n    '24',\n    '25',\n    '26',\n\
    \    '27',\n    '28',\n    '29',\n    '30',\n    '31',\n    '32',\n    '33',\n\
    \    '34',\n    'AppImage',\n    'backend',\n    'basic',\n    'bfd',\n    'bin',\n\
    \    'build',\n    'emacs',\n    'ext',\n    'gtk3',\n    'nox',\n    'real',\n\
    \    'smp',\n    'test',\n    'tiny'\n  )\n  AND NOT basename IN ('io.elementary.appcenter')\n\
    \  AND NOT basename IN ('rpc.mountd')\n  AND NOT basename LIKE 'kubectl-%'\n \
    \ AND NOT basename LIKE 'ld-%.so'\n  AND NOT basename LIKE 'python2.%'\n  AND\
    \ NOT basename LIKE 'python3.%'\n  AND NOT basename LIKE 'emacs-%'\n  AND NOT\
    \ basename LIKE 'terraform-provider%'\n  AND NOT basename LIKE 'unison-%'\n"
  platform: linux
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
