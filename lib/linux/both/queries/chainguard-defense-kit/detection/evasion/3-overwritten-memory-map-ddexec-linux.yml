- name: CDK - Overwritten Memory Map Ddexec Linux
  description: Processes with a memory map that suggests they might be code smuggling.
  query: "SELECT\n  pmm.path AS mmap_path,\n  pmm.start as mmap_start,\n  pmm.end\
    \ AS mmap_end,\n  -- Child\n  p0.pid AS p0_pid,\n  p0.path AS p0_path,\n  p0.name\
    \ AS p0_name,\n  p0.cmdline AS p0_cmd,\n  p0.cwd AS p0_cwd,\n  p0.cgroup_path\
    \ AS p0_cgroup,\n  p0.euid AS p0_euid,\n  p0_hash.sha256 AS p0_sha256,\n  -- Parent\n\
    \  p0.parent AS p1_pid,\n  p1.path AS p1_path,\n  p1.name AS p1_name,\n  p1.euid\
    \ AS p1_euid,\n  p1.cmdline AS p1_cmd,\n  p1_hash.sha256 AS p1_sha256,\n  -- Grandparent\n\
    \  p1.parent AS p2_pid,\n  p2.name AS p2_name,\n  p2.path AS p2_path,\n  p2.cmdline\
    \ AS p2_cmd,\n  p2_hash.sha256 AS p2_sha256\nFROM\n  processes p0\n  JOIN process_memory_map\
    \ pmm ON p0.pid = pmm.pid\n  LEFT JOIN hash p0_hash ON p0.path = p0_hash.path\n\
    \  LEFT JOIN processes p1 ON p0.parent = p1.pid\n  LEFT JOIN hash p1_hash ON p1.path\
    \ = p1_hash.path\n  LEFT JOIN processes p2 ON p1.parent = p2.pid\n  LEFT JOIN\
    \ hash p2_hash ON p2.path = p2_hash.path\nWHERE\n  p0.path != \"\"\n  AND pmm.offset\
    \ = 0\n  AND pmm.device = '00:00'\n  AND pmm.permissions = 'r--p'\n  AND pmm.pseudo\
    \ = 0\n  and pmm.start LIKE '0x0%'\nGROUP BY\n  p0.pid;\n"
  platform: linux
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
