- name: CDK - Touched Executable Linux
  description: Programs which were spawned by an executable containing a matching
    ctime & mtime, which on Linux only generally occurs occurs if you run 'touch <bin>'
  query: "SELECT\n  p.pid,\n  p.path,\n  p.name,\n  p.cmdline,\n  p.cgroup_path,\n\
    \  p.cwd,\n  p.euid,\n  p.parent,\n  f.ctime,\n  f.btime,\n  f.mtime,\n  p.start_time,\n\
    \  pp.path AS parent_path,\n  pp.cmdline AS parent_cmd,\n  pp.cwd AS parent_cwd,\n\
    \  hash.sha256 AS sha256\nFROM\n  processes p\n  LEFT JOIN file f ON p.path =\
    \ f.path\n  LEFT JOIN processes pp ON p.parent = pp.pid\n  LEFT JOIN hash ON p.path\
    \ = hash.path\nWHERE\n  f.ctime = f.mtime\n  AND (strftime('%s', 'now') - p.start_time)\
    \ > 25000\n  AND p.path != '/'\n  AND f.path NOT IN (\n    '/opt/Elastic/Endpoint/elastic-endpoint',\n\
    \    '/opt/google/endpoint-verification/bin/apihelper',\n    '/opt/resolve/bin/resolve',\n\
    \    '/usr/bin/ld.bfd',\n    '/usr/bin/ld',\n    '/usr/bin/ghostty',\n    '/usr/bin/melange',\n\
    \    '/var/opt/velociraptor/bin/velociraptor'\n  )\n  AND f.path NOT LIKE '/home/%'\n\
    \  AND f.path NOT LIKE '/opt/Elastic/Agent/data/elastic-agent%'\n  AND f.path\
    \ NOT LIKE '/opt/rapid7/ir_agent/%'\n  AND f.path NOT LIKE '/snap/%'\n  AND f.path\
    \ NOT LIKE '/tmp/%/.terraform/providers/%'\n  AND f.path NOT LIKE '/tmp/%go-build%/exe/%'\n\
    \  AND f.path NOT LIKE '/tmp/cargo-install%/%'\n  AND f.path NOT LIKE '/tmp/go-build%'\n\
    \  AND f.path NOT LIKE '/usr/local/aws-cli/%/dist/aws'\n  AND f.path NOT LIKE\
    \ '/usr/local/bin/%'\n  AND f.path NOT LIKE '/usr/local/kolide-k2/bin/%-updates/%'\n\
    \  AND f.path NOT LIKe '/var/home/%'\n  AND f.path NOT LIKE '/var/home/linuxbrew/.linuxbrew/%'\n\
    \  AND f.path NOT LIKE '/var/home/linuxbrew/.linuxbrew/Cellar/%/bin/%'\n  AND\
    \ f.path NOT LIKE '/var/kolide-k2/k2device.kolide.com/updates/%'\n  AND f.path\
    \ NOT LIKE '/var/opt/Elastic/Endpoint/elastic-endpoint'\n  AND f.path NOT LIKE\
    \ '%/go/bin/%'\n  AND f.path NOT LIKE '%/osqueryi'\n  AND p.name NOT LIKE 'osqtool%'\n\
    GROUP by\n  p.pid\n"
  platform: linux
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
