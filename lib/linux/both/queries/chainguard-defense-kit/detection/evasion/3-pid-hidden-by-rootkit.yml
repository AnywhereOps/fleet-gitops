- name: CDK - Pid Hidden By Rootkit
  description: Finds processes that are apparently hidden by a rootkit Confirmed to
    catch revenge-rtkit
  query: "WITH RECURSIVE\n  cnt (x) AS (\n    SELECT\n      1\n    UNION ALL\n   \
    \ SELECT\n      x + 1\n    FROM\n      cnt\n    LIMIT\n      32768\n  )\nSELECT\n\
    \  p.*\nFROM\n  cnt\n  JOIN processes p ON x = p.pid\nWHERE\n  x NOT IN (\n  \
    \  SELECT\n      pid\n    FROM\n      processes\n  )\n  AND p.start_time < (strftime('%s',\
    \ 'now') - 1) -- Improve how we filter tasks out.\n  -- This is not very precise.\
    \ What we really want to do is verify that\n  -- this pid is not listed as a task\
    \ of any other pid\n  AND (\n    p.pgroup = p.pid\n    OR (\n      p.pid = p.parent\n\
    \      AND p.threads = 1\n    )\n  )\n"
  platform: linux
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
