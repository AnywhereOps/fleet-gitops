- name: CDK - Unusually Tainted Kernel Linux
  description: Unusually tainted kernel - via a loaded kernel module Confirmed to
    catch revenge-rtkit
  query: "SELECT\n  taint,\n  taint & 65536 AS is_aux,\n  taint & 8192 is_unsigned,\n\
    \  taint & 4096 AS out_of_tree,\n  taint & 512 AS kernel_warning,\n  taint & 614\
    \ AS requested_by_userspace,\n  taint & 8 AS force_unloaded,\n  taint & 4 AS out_of_spec,\n\
    \  taint & 2 AS force_loaded,\n  taint & 1 AS proprietary,\n  modules\nFROM\n\
    \  (\n    SELECT\n      sc.current_value AS taint,\n      GROUP_CONCAT(km.name)\
    \ AS modules\n    FROM\n      system_controls sc,\n      kernel_modules km\n \
    \   WHERE\n      sc.name = \"kernel.tainted\"\n    ORDER BY\n      km.name ASC\n\
    \  )\n  -- 4096 is a signed, out of tree, open source driver\n  -- 4097 is a signed,\
    \ out of tree, proprietary driver\n  -- 512 is a kernel warning\nWHERE\n  taint\
    \ NOT IN (0, 512, 4096, 4097)\n  -- Some day, folks will sign rootkits. That day\
    \ isn't today.\n  AND is_unsigned = 1\n  AND NOT (\n    (\n      -- 12289 is an\
    \ unsigned, out of tree, proprietary\n      -- 12801 is an unsigned, out of tree,\
    \ proprietary with kernel warning. not great.\n      taint IN (12289, 12801)\n\
    \      AND (\n        modules LIKE \"%,nvidia,%\"\n        OR modules LIKE \"\
    %,v42loopback,%\"\n        OR modules LIKE \"%,wl,%\"\n      )\n    )\n    OR\
    \ (\n      -- 12352 is unsigned, out of tree, requested by user space\n      --\
    \ 12289 is an unsigned, out of tree, proprietary\n      taint IN (12352, 12289)\n\
    \      AND modules LIKE \"%,v4l2loopback,%\"\n    )\n  )\n"
  platform: linux
  interval: 3600
  observer_can_run: true
  automations_enabled: false
  logging: snapshot
  discard_data: false
